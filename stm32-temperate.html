<!DOCTYPE html>
<html lang>
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="description" content="STM32 内部温度传感器">




  <meta name="keywords" content="电子设计,">





  <link rel="alternate" href="/default" title="Rming">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.2">



<link rel="canonical" href="http://rmingwang.com/stm32-temperate.html">


<meta name="description" content="STM32内部温度传感器简介STM32有一个内部的温度传感器，可以用来测量 CPU 及周围的温度(TA) 。 该温度传感器在内部和ADCx_IN16输入通道相连接，此通道把传感器输出的电压转换成数字值。温度传感器模拟输入推荐采样时间是17.1 μ s 。 STM32 的内部温度传感器支持的温度范围为：-40~125 度。精度比较差，为±1.5℃左右。 STM32内部温度传感器的使用很简单，只要设置">
<meta name="keywords" content="电子设计">
<meta property="og:type" content="article">
<meta property="og:title" content="STM32 内部温度传感器">
<meta property="og:url" content="http://rmingwang.com/stm32-temperate.html">
<meta property="og:site_name" content="Rming">
<meta property="og:description" content="STM32内部温度传感器简介STM32有一个内部的温度传感器，可以用来测量 CPU 及周围的温度(TA) 。 该温度传感器在内部和ADCx_IN16输入通道相连接，此通道把传感器输出的电压转换成数字值。温度传感器模拟输入推荐采样时间是17.1 μ s 。 STM32 的内部温度传感器支持的温度范围为：-40~125 度。精度比较差，为±1.5℃左右。 STM32内部温度传感器的使用很简单，只要设置">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2012-10-17T18:30:13.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="STM32 内部温度传感器">
<meta name="twitter:description" content="STM32内部温度传感器简介STM32有一个内部的温度传感器，可以用来测量 CPU 及周围的温度(TA) 。 该温度传感器在内部和ADCx_IN16输入通道相连接，此通道把传感器输出的电压转换成数字值。温度传感器模拟输入推荐采样时间是17.1 μ s 。 STM32 的内部温度传感器支持的温度范围为：-40~125 度。精度比较差，为±1.5℃左右。 STM32内部温度传感器的使用很简单，只要设置">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.2">
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">





<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: false
    },
  };
</script>




  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?26275cbf6baa00fb8df9ba266da07c6d";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-22663233-12', 'auto');
        ga('send', 'pageview');
  </script>





  


    <title> STM32 内部温度传感器 - Rming </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">Rming</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/links.html">
                            
                            
                                友情链接
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          STM32 内部温度传感器
        
      </h1>

      <time class="post-time">
          7月 24 2012
      </time>
    </header>



    
            <div class="post-content">
            <p></p><h2><span id="stm32内部温度传感器简介">STM32内部温度传感器简介</span></h2><br>STM32有一个<strong>内部的温度传感器</strong>，可以用来<strong>测量 CPU 及周围的温度(TA)</strong> 。<p></p>
<p><strong>该温度传感器在内部和ADCx_IN16输入通道相连接</strong>，此通道把传感器输出的电压转换成数字值。温度传感器模拟输入推荐采样时间是17.1 μ s 。 STM32 的内部温度传感器支持的温度范围为：-40~125 度。精度比较差，为±1.5℃左右。</p>
<p>STM32内部温度传感器的使用很简单，只要设置一下内部 ADC，并激活其内部通道就差不多了。关于 ADC的设置，我们在上一节已经进行了详细的介绍，这里就不再多说。接下来我们介绍一下和温度传感器设置相关的2 个地方。</p>
<p><ol><br>    <li>第一个地方，我们要使用STM32的内部温度传感器，必须先激活 ADC的内部通道，<strong>这里通过<span style="color: #ff0000;">ADC_CR1的AW D E N </span>位</strong>（bit23）设置。设置该位为 1 则启用内部温度传感器。</li><br>    <li>第二个地方，STM32的内部温度传感器固定的连接在 ADC的通道16上，所以，我们在设置好ADC之后只要<span style="color: #ff0000;"><strong>读取通道16的值</strong></span>，就是温度传感器返回来的电压值了。</li><br></ol><br>根据这个值，我们就可以计算出当前温度。计算公式如下：</p>
<p></p><p style="text-align: center;"><strong>T （℃）={（V25-Vsense ）/Avg_Slope}+25 </strong></p><br>&nbsp;<p></p>
<p><ul><br>    <li>V25=Vsense在25 度时的数值（典型值为：1.43 ）。</li><br>    <li>Avg_Slope=温度与Vsense 曲线的平均斜率（单位为 mv/℃或uv/℃）（典型值为4.3Mv/℃）。</li><br></ul><br>利用以上公式，我们就可以方便的计算出当前温度传感器的温度了。</p>
<p></p><h2><span id="寄存器操作步骤">寄存器操作步骤</span></h2><p></p>
<p></p><h3><span id="1设置adc并开启adc_-cr2-的tsvrefe-位激活内部通道adc1_in16温度传感器">1，设置ADC，并开启ADC_ CR2 的TSVREFE 位激活内部通道：ADC1_IN16(温度传感器)</span></h3><br>关于如何设置ADC，上一节已经介绍了，我们采用与上一节一样的设置，这里我们只要增加使能TSVREFE 位这一句就可以了。<p></p>
<p></p><h3><span id="2读取通道16的ad值计算结果">2，读取通道16的AD值，计算结果。</span></h3><br>在设置完之后，我们就可以读取温度传感器的电压值了，得到该值就可以用上面的公式计算温度值了。<p></p>
<p></p><h2><span id="程序设计">程序设计</span></h2><br>//MAIN.C<p></p>
<pre class="brush: php; gutter: true">#include &lt;stm32f10x_lib.h&gt;
#include &quot;sys.h&quot;
#include &quot;usart.h&quot;
#include &quot;delay.h&quot;
#include &quot;led.h&quot;
#include &quot;key.h&quot;
#include &quot;exti.h&quot;
#include &quot;wdg.h&quot;
#include &quot;timer.h&quot;
#include &quot;lcd.h&quot;
#include &quot;rtc.h&quot;
#include &quot;wkup.h&quot;
#include &quot;adc.h&quot;
//内部温度传感器 实验
int main(void)
{
u16 adcx;
float temp;
float temperate;
Stm32_Clock_Init(9);//系统时钟设置
delay_init(72); //延时初始化
uart_init(72,9600); //串口1初始化
led_init();
LCD_Init();
Adc_Init();

POINT_COLOR=RED;//设置字体为红色
LCD_ShowString(60,110,&quot;TEMPERATE TEST&quot;);
//显示时间
POINT_COLOR=BLUE;//设置字体为蓝色
LCD_ShowString(60,130,&quot;TEMP_VAL:&quot;);
LCD_ShowString(60,150,&quot;TEMP_VOL:0.000V&quot;);
LCD_ShowString(60,170,&quot;TEMPERATE:00.00C&quot;);
while(1)
{
adcx=Get_Temp();
LCD_ShowNum(132,130,adcx,4,16);//显示ADC的值
temp=(float)adcx*(3.3/4096);
temperate=temp;//保存温度传感器的电压值
adcx=temp;
LCD_ShowNum(132,150,adcx,1,16); //显示电压值整数部分
temp-=(u8)temp; //减掉整数部分
LCD_ShowNum(148,150,temp*1000,3,16);//显示电压小数部分

temperate=(1.43-temperate)/0.0043+25;//计算出当前温度值
LCD_ShowNum(140,170,(u8)temperate,2,16); //显示温度整数部分
temperate-=(u8)temperate;
LCD_ShowNum(164,170,temperate*100,2,16);//显示温度小数部分
LED0=!LED0;
delay_ms(250);
}
}</pre>
//ADC.C
<pre class="brush: php; gutter: true">#include &lt;stm32f10x_lib.h&gt;
#include &quot;adc.h&quot;
#include &quot;delay.h&quot;
//ADC 驱动代码
//初始化ADC
//这里我们仅以规则通道为例
//我们默认将开启通道0~3
void Adc_Init(void)
{
//先初始化IO口
RCC-&gt;APB2ENR|=1&lt;&lt;2; //使能PORTA口时钟
GPIOA-&gt;CRL&amp;=0XFFFF0000;//PA0 1 2 3 anolog输入
//通道10/11设置
RCC-&gt;APB2ENR|=1&lt;&lt;9; //ADC1时钟使能
RCC-&gt;APB2RSTR|=1&lt;&lt;9; //ADC1复位
RCC-&gt;APB2RSTR&amp;=~(1&lt;&lt;9);//复位结束
RCC-&gt;CFGR&amp;=~(3&lt;&lt;14); //分频因子清零
//SYSCLK/DIV2=12M ADC时钟设置为12M,ADC最大时钟不能超过14M!
//否则将导致ADC准确度下降!
RCC-&gt;CFGR|=2&lt;&lt;14;

ADC1-&gt;CR1&amp;=0XF0FFFF; //工作模式清零
ADC1-&gt;CR1|=0&lt;&lt;16; //独立工作模式
ADC1-&gt;CR1&amp;=~(1&lt;&lt;8); //非扫描模式
ADC1-&gt;CR2&amp;=~(1&lt;&lt;1); //单次转换模式
ADC1-&gt;CR2&amp;=~(7&lt;&lt;17);
ADC1-&gt;CR2|=7&lt;&lt;17; //软件控制转换
ADC1-&gt;CR2|=1&lt;&lt;20; //使用用外部触发(SWSTART)!!! 必须使用一个事件来触发
ADC1-&gt;CR2&amp;=~(1&lt;&lt;11); //右对齐
ADC1-&gt;CR2|=1&lt;&lt;23; //使能温度传感器 必须设置TSVREFE 位激活内部通道：ADC1_IN16(温度传感器)

ADC1-&gt;SQR1&amp;=~(0XF&lt;&lt;20);
ADC1-&gt;SQR1&amp;=0&lt;&lt;20; //1个转换在规则序列中 也就是只转换规则序列1
//设置通道0~3的采样时间
ADC1-&gt;SMPR2&amp;=0XFFFFF000;//通道0,1,2,3采样时间清空
ADC1-&gt;SMPR2|=7&lt;&lt;9; //通道3 239.5周期,提高采样时间可以提高精确度
ADC1-&gt;SMPR2|=7&lt;&lt;6; //通道2 239.5周期,提高采样时间可以提高精确度
ADC1-&gt;SMPR2|=7&lt;&lt;3; //通道1 239.5周期,提高采样时间可以提高精确度
ADC1-&gt;SMPR2|=7&lt;&lt;0; //通道0 239.5周期,提高采样时间可以提高精确度

ADC1-&gt;SMPR1&amp;=~(7&lt;&lt;18); //清除通道16原来的设置
ADC1-&gt;SMPR1|=7&lt;&lt;18; //通道16 239.5周期,提高采样时间可以提高精确度

ADC1-&gt;CR2|=1&lt;&lt;0; //开启AD转换器
ADC1-&gt;CR2|=1&lt;&lt;3; //使能复位校准
while(ADC1-&gt;CR2&amp;1&lt;&lt;3); //等待校准结束
//该位由软件设置并由硬件清除。在校准寄存器被初始化后该位将被清除。
ADC1-&gt;CR2|=1&lt;&lt;2; //开启AD校准
while(ADC1-&gt;CR2&amp;1&lt;&lt;2); //等待校准结束
//该位由软件设置以开始校准，并在校准结束时由硬件清除
}
//获得ADC值
//ch:通道值 0~3
u16 Get_Adc(u8 ch)
{
//设置转换序列
ADC1-&gt;SQR3&amp;=0XFFFFFFE0;//规则序列1 通道ch
ADC1-&gt;SQR3|=ch;
ADC1-&gt;CR2|=1&lt;&lt;22; //启动规则转换通道
while(!(ADC1-&gt;SR&amp;1&lt;&lt;1));//等待转换结束
return ADC1-&gt;DR; //返回adc值
}
//得到ADC采样内部温度传感器的值
//取10次,然后平均
u16 Get_Temp(void)
{

u16 temp_val=0;
u8 t;
for(t=0;t&lt;10;t++)
{
temp_val+=Get_Adc(TEMP_CH);
delay_ms(5);
}
return temp_val/10;
}</pre>
ADC.H
<pre class="brush: php; gutter: true">#ifndef __ADC_H
#define __ADC_H

#define ADC_CH0 0 //通道0
#define ADC_CH1 1 //通道1
#define ADC_CH2 2 //通道2
#define ADC_CH3 3 //通道3
#define TEMP_CH 16 //温度传感器通道

u16 Get_Temp(void); //取得温度值
void Adc_Init(void); //ADC通道初始化
u16 Get_Adc(u8 ch); //获得某个通道值
#endif</pre>
            </div>
          

    
      <footer class="post-footer">
        <div class="post-tags">
          
            <a href="/tags/电子设计/">电子设计</a>
          
        </div>

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/stm32-iic-24c02.html">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">STM32 IIC读写AT24C02</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/stm32-dma.html">
        <span class="next-text nav-default">STM32 DMA直接存储器访问简介</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
    <div style="text-align:center;">
        <button class="btn" id="load-disqus" onclick="disqus.load();">加载 Disqus 评论</button>
    </div>
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2008 -
    
    2019
    <span class="footer-author">Rming.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a> and <a class="theme-link" href="https://github.com/Rming/hexo-theme-polarbearsimple">Polar Bear Simple</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    

<script type="text/javascript">
  var disqus_shortname = 'rming';
  var disqus_identifier = '/stm32-temperate.html';

  var disqus_title = "STM32 内部温度传感器";


  var disqus = {
    load : function disqus(){
        if(typeof DISQUS !== 'object') {
          (function () {
          var s = document.createElement('script'); s.async = true;
          s.type = 'text/javascript';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
          }());
          $('#load-disqus').remove(); ///加载后移除按钮
        }
    }
  }

  
    var disqus_config = function () {
        this.page.url = disqus_url;
        this.page.identifier = disqus_identifier;
        this.page.title = disqus_title;
    };
  

</script>


    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  

    <script type="text/javascript" src="/js/src/theme.js?v=1.2"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.2"></script>

  </body>
</html>
